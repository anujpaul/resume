<!-- chat.component.html -->
<div class="chat-widget" [class.minimized]="isMinimized" [class.expanded]="isExpanded">
  
    <!-- Chat Button (Minimized State) -->
    <div *ngIf="isMinimized" class="chat-button" (click)="toggleChat()">
      <div class="chat-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"/>
        </svg>
      </div>
      <span class="pulse-dot"></span>
    </div>
  
    <!-- Chat Window (Open State) -->
    <div *ngIf="!isMinimized" class="chat-window">
      
      <!-- Header -->
      <div class="chat-header">
        <div class="header-info">
          <div class="avatar">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"/>
            </svg>
          </div>
          <div class="header-text">
            <h4>AI Assistant</h4>
            <span class="status">Online</span>
          </div>
        </div>
        <div class="header-actions">
          <button class="icon-button" (click)="toggleExpand()" [title]="isExpanded ? 'Collapse' : 'Expand'">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
            </svg>
          </button>
          <button class="icon-button" (click)="closeChat()" title="Close">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
          </button>
        </div>
      </div>
  
      <!-- Messages -->
      <div #chatContainer class="chat-messages">
        <div 
          *ngFor="let message of messages" 
          [class]="message.isUser ? 'user-message' : 'bot-message'"
          class="message"
        >
          <div class="message-content">
            {{ message.text }}
          </div>
          <div class="message-time">
            {{ formatTime(message.timestamp) }} <!-- Use the method instead of pipe -->
          </div>
        </div>
  
        <div *ngIf="isTyping" class="typing-indicator">
          <div class="typing-dots">
            <span></span>
            <span></span>
            <span></span>
          </div>
          <span>AI is typing...</span>
        </div>
      </div>
  
      <!-- Input -->
      <div class="chat-input-container">
        <div class="input-wrapper">
          <textarea
            [(ngModel)]="userInput"
            (keydown)="onKeyPress($event)"
            placeholder="Type your message here..."
            rows="1"
            class="chat-input"
          ></textarea>
          <button 
            (click)="sendMessage()" 
            [disabled]="!userInput.trim()"
            class="send-button"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
              <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>